<!doctype html>
<html lang="ja">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css"
		integrity="sha384-PJsj/BTMqILvmcej7ulplguok8ag4xFTPryRq8xevL7eBYSmpXKcbNVuy+P0RMgq" crossorigin="anonymous">

	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link
		href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&family=Noto+Serif+JP:wght@200..900&family=Zen+Maru+Gothic&display=swap"
		rel="stylesheet">

	<title>ä½ä¹…çŸ¥ã®ä½œæ¥­ãƒ­ã‚°</title>

	<style>
		body {
			font-family: "Zen Maru Gothic", serif;
		}

		.hidden-date {
			display: none;
		}

		.log-text {
			font-family: monospace;
			/* å¿…é ˆ: ç­‰å¹… */
			white-space: pre;
			/* ã‚¿ãƒ–ã‚’ç¶­æŒ */
			tab-size: 4;
			/* ã‚¿ãƒ–ã®å¹…ã‚’èª¿æ•´ï¼ˆå¥½ã¿ã«ã‚ˆã‚Šå¤‰æ›´å¯ï¼‰ */
		}
	</style>
</head>

<body>
	<nav class="navbar bg-primary" data-bs-theme="dark">
		<div class="container-fluid">
			<span class="navbar-brand mb-0 h1">ä½ä¹…çŸ¥ã®ä½œæ¥­ãƒ­ã‚°</span>
		</div>
	</nav>

	<div class="container">
		<div class="row mb-3">
			<!--			<div class="col">-->
			<!--				<form th:action="@{/home/result}" th:object=${fdata} method="post">-->
			<!--					<label for="posttext" class="form-label">æŠ•ç¨¿å†…å®¹</label>-->
			<!--					<input type="text" class="form-control" th:field="*{postText}" id="posttext">-->
			<!--					<input type="submit" class="btn btn-success mt-3" value="æŠ•ç¨¿ã™ã‚‹"></input>-->
			<!--					<a th:href="@{/home}" class="btn btn-warning me-1 mt-3">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>-->
			<!--				</form>-->
			<!--			</div>-->



			<div class="col">
				<form th:action="@{/home/select}" th:object="${fdata}" method="get">
					<label class="form-label mb-1">æ—¥ä»˜æŒ‡å®š</label>

					<!-- â–¼ æ—¥ä»˜ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ -->
					<div class="d-flex align-items-center gap-2">
						<select id="year" class="form-select form-select-sm" style="width: 80px;">
							<option value="">å¹´</option>
						</select>

						<select id="month" class="form-select form-select-sm" style="width: 80px;">
							<option value="">æœˆ</option>
						</select>

						<select id="day" class="form-select form-select-sm" style="width: 80px;">
							<option value="">æ—¥</option>
						</select>

						<!-- LocalDate ä¿å­˜ç”¨ -->
						<!--						<input type="hidden" th:field="*{logDate}" id="logDate">-->
						<!--						<input type="hidden" id="logDate" th:value="${#temporals.format(fdata.logDate, 'yyyy-MM-dd')}">-->
						<input type="hidden" id="logDate" name="logDate"
							th:value="${#temporals.format(fdata.logDate, 'yyyy-MM-dd')}">

					</div>

					<div class="mt-2">
						<button type="submit" class="btn btn-primary btn-sm">æŒ‡å®šã™ã‚‹</button>
						<a th:href="@{/home/diary}" class="btn btn-warning btn-sm">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</a>
						<a th:href="@{/home/todo}" class="btn btn-success btn-sm">
							ğŸ“ Todo
						</a>
					</div>

				</form>
			</div>

			<!--			<div class="col">-->
			<!--				<form th:action="@{/home/create}" th:object=${fdata} method="post">-->
			<!--					<label class="form-label mb-1">æ—¥æ™‚æ¤œç´¢</label>-->

			<!--					<div class="d-flex align-items-center gap-2">-->

			<!--						<select id="year" class="form-select form-select-sm" style="width: 80px;">-->
			<!--							<option value="">å¹´</option>-->
			<!--						</select>-->

			<!--						<select id="month" class="form-select form-select-sm" style="width: 80px;">-->
			<!--							<option value="">æœˆ</option>-->
			<!--						</select>-->

			<!--						<select id="day" class="form-select form-select-sm" style="width: 80px;">-->
			<!--							<option value="">æ—¥</option>-->
			<!--						</select>-->

			<!--						 LocalDate ãŒå…¥ã‚‹ hidden -->
			<!--						<input type="hidden" th:field="*{logDate}" id="logDate">-->
			<!--					</div>-->

			<!--					<div class="mt-2">-->
			<!--						<input type="submit" class="btn btn-primary btn-sm" value="æŒ‡å®šã™ã‚‹">-->
			<!--						<a href="/home/diary" class="btn btn-warning btn-sm me-1">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</a>-->
			<!--					</div>-->
			<!--				</form>-->
			<!--			</div>-->



			<!--			<div class="col">-->
			<!--			    <form th:action="@{/home/create}" th:object=${fdata} method="post">-->
			<!--			        <label class="form-label">æ—¥æ™‚æ¤œç´¢</label>-->

			<!--			        <div class="row g-2 align-items-center">-->
			<!--			            <div class="col">-->
			<!--			                <select id="year" class="form-select">-->
			<!--			                    <option value="">å¹´</option>-->
			<!--			                </select>-->
			<!--			            </div>-->

			<!--			            <div class="col">-->
			<!--			                <select id="month" class="form-select">-->
			<!--			                    <option value="">æœˆ</option>-->
			<!--			                </select>-->
			<!--			            </div>-->

			<!--			            <div class="col">-->
			<!--			                <select id="day" class="form-select">-->
			<!--			                    <option value="">æ—¥</option>-->
			<!--			                </select>-->
			<!--			            </div>-->

			<!--			             hidden input: YYYYMMDD -->
			<!--			            <input type="hidden" th:field="*{dateNumber}" id="datenumber">-->
			<!--			        </div>-->

			<!--			        <input type="submit" class="btn btn-primary mt-3" value="æŒ‡å®šã™ã‚‹"></input>-->
			<!--			        <a href="/home/diary" class="btn btn-warning mt-3 me-1">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</a>-->
			<!--			    </form>-->
			<!--			</div>-->

			<!--			<div class="col">-->
			<!--			    <form th:action="@{/home/create}" th:object=${fdata} method="post">-->
			<!--			        <label class="form-label">æ—¥æ™‚æ¤œç´¢</label>-->

			<!--			         å¹´ -->
			<!--			        <select id="year" class="form-select mb-2">-->
			<!--			            <option value="">å¹´</option>-->
			<!--			        </select>-->

			<!--			         æœˆ -->
			<!--			        <select id="month" class="form-select mb-2">-->
			<!--			            <option value="">æœˆ</option>-->
			<!--			        </select>-->

			<!--			         æ—¥ -->
			<!--			        <select id="day" class="form-select mb-3">-->
			<!--			            <option value="">æ—¥</option>-->
			<!--			        </select>-->

			<!--			         hiddenã«ã¾ã¨ã‚ãŸæ•°å­—ã‚’é€ã‚‹ -->
			<!--			        <input type="hidden" th:field="*{dateNumber}" id="datenumber">-->

			<!--			        <input type="submit" class="btn btn-primary mt-3" value="æŒ‡å®šã™ã‚‹"></input>-->
			<!--			        <a href="/home/diary" class="btn btn-warning mt-3 me-1">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</a>-->
			<!--			    </form>-->
			<!--			</div>-->

			<!--<div class="col">
				<form th:action="@{/home/create}" th:object=${fdata} method="post">
					<label for="datenumber" class="form-label">æ—¥æ™‚æ¤œç´¢</label>
					<input type="number" class="form-control" th:field="*{dateNumber}" id="datenumber"
						placeholder="20200806">
					<input type="submit" class="btn btn-primary mt-3" value="æŒ‡å®šã™ã‚‹"></input>
					<a href="/home/diary" class="btn btn-warning mt-3 me-1">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</a>
				</form>
			</div-->>
		</div>
		<div>
			<p th:text="${message}"></p>
		</div>

		<div class="row">
			<div class="col">

				<!-- â–¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡ã„å ´åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º -->
				<div th:if="${!log.exists}" class="alert alert-warning mt-3">
					æŒ‡å®šã—ãŸæ—¥ä»˜ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã›ã‚“ã€‚
					<a th:href="@{/home/create}" class="btn btn-success btn-sm">æ–°è¦ä½œæˆ</a>
				</div>

				<div th:if="${log.exists}">
					<p th:text="${fileName}"></p>

					<h4 th:text="${log.displayDate}"></h4>

					<div th:each="block : ${log.blocks}">
						<div th:if="${block.time != null}">
							<span th:text="${block.time}"></span>
						</div>

						<ul>
							<li th:each="item : ${block.items}" th:text="${item}"></li>
						</ul>
					</div>
				</div>

				<div>
					<!-- ãƒ­ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼šå†…å®¹è¡¨ç¤º -->
					<!--				<div th:if="${exists}">-->
					<!--					<div th:each="line : ${lines}">-->
					<!--						<pre class="log-text" th:utext="${line}"></pre>-->
					<!--					</div>-->
					<!--				</div>-->

					<!--				<div th:if="${exists}">-->
					<!--					<p class="text-success">è¨˜äº‹ãŒå­˜åœ¨ã—ã¾ã™</p>-->
					<!--					<a th:href="@{/home/diary}" class="btn btn-primary">è¨˜äº‹ã‚’è¦‹ã‚‹</a>-->
					<!--					<a th:href="@{/home}" class="btn btn-warning">æˆ»ã‚‹</a>-->
					<!--				</div>-->

					<!--				 ãƒ­ã‚°ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ & æ–°è¦ä½œæˆãƒœã‚¿ãƒ³ -->
					<!--				<div th:if="${exists == false}">-->
					<!--					<p th:text="${text}"></p>-->
					<!--					<a th:href="@{/home/create(fileName=${fileName})}" class="btn btn-success mt-3">-->
					<!--						æ–°è¦ãƒ­ã‚°ã‚’ä½œæˆã™ã‚‹-->
					<!--					</a>-->
					<!--				</div>-->

				</div>
			</div>
		</div>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous">
			</script>

		<!--	<script>-->
		<!--		console.log("JS loaded");-->

		<!--		const yearEl = document.getElementById("year");-->
		<!--		const monthEl = document.getElementById("month");-->
		<!--		const dayEl = document.getElementById("day");-->
		<!--		const logDateEl = document.getElementById("logDate");-->

		<!--		/* ---------- å¹´ãƒ»æœˆ options ---------- */-->
		<!--			for (let y = 2020; y <= 2070; y++) {-->
		<!--				yearEl.insertAdjacentHTML("beforeend",-->
		<!--					`<option value="${y}">${y}å¹´</option>`);-->
		<!--			}-->
		<!--			for (let m = 1; m <= 12; m++) {-->
		<!--				monthEl.insertAdjacentHTML("beforeend",-->
		<!--					`<option value="${String(m).padStart(2, "0")}">${m}æœˆ</option>`);-->
		<!--			}-->

		<!--		/* ---------- æ—¥ options ---------- */-->
		<!--		function updateDays() {-->
		<!--			const year = yearEl.value;-->
		<!--			const month = monthEl.value;-->
		<!--			if (!year || !month) return;-->

		<!--			const lastDay = new Date(year, Number(month), 0).getDate();-->
		<!--			dayEl.innerHTML = '<option value="">æ—¥</option>';-->

		<!--			for (let d = 1; d <= lastDay; d++) {-->
		<!--				dayEl.insertAdjacentHTML("beforeend",-->
		<!--					`<option value="${String(d).padStart(2, "0")}">${d}æ—¥</option>`);-->
		<!--			}-->
		<!--		}-->

		<!--		/* ---------- hidden æ›´æ–° ---------- */-->
		<!--		function setDateHidden() {-->
		<!--			if (yearEl.value && monthEl.value && dayEl.value) {-->
		<!--				logDateEl.value = `${yearEl.value}-${monthEl.value}-${dayEl.value}`;-->
		<!--				console.log("hidden logDate =", logDateEl.value);-->
		<!--			}-->
		<!--		}-->

		<!--		yearEl.addEventListener("change", () => {-->
		<!--			updateDays();-->
		<!--			setDateHidden();-->
		<!--		});-->
		<!--		monthEl.addEventListener("change", () => {-->
		<!--			updateDays();-->
		<!--			setDateHidden();-->
		<!--		});-->
		<!--		dayEl.addEventListener("change", setDateHidden);-->

		<!--		/* ---------- åˆæœŸåŒ–ï¼ˆã“ã“ãŒè¶…é‡è¦ï¼‰ ---------- */-->
		<!--		(function initDateOnce() {-->
		<!--			const initialDate = logDateEl.value;-->
		<!--			console.log("initialDate =", initialDate);-->

		<!--			if (initialDate) {-->
		<!--				const parts = initialDate.split("-"); // â† ã“ã‚Œã ã‘ã§OK-->

		<!--				if (parts.length === 3) {-->
		<!--					yearEl.value = parts[0];-->
		<!--					monthEl.value = parts[1].padStart(2, "0");-->
		<!--					updateDays();-->
		<!--					dayEl.value = parts[2].padStart(2, "0");-->
		<!--					return; // â† ã“ã“ã§çµ‚äº†ï¼ˆä»Šæ—¥ã®æ—¥ä»˜ã‚’ä½¿ã‚ãªã„ï¼‰-->
		<!--				}-->
		<!--			}-->

		<!--			// hidden ãŒç„¡ã„ã¨ãã ã‘ã€Œä»Šæ—¥ã€-->
		<!--			const today = new Date();-->
		<!--			yearEl.value = today.getFullYear();-->
		<!--			monthEl.value = String(today.getMonth() + 1).padStart(2, "0");-->
		<!--			updateDays();-->
		<!--			dayEl.value = String(today.getDate()).padStart(2, "0");-->
		<!--			setDateHidden();-->
		<!--		})();-->


		<!--	</script>-->

		<script>
			console.log("JS loaded");

			const yearEl = document.getElementById("year");
			const monthEl = document.getElementById("month");
			const dayEl = document.getElementById("day");
			const logDateEl = document.getElementById("logDate");

			/* ===== å¹´ã®ç”Ÿæˆ ===== */
			for (let y = 2020; y <= 2070; y++) {
				yearEl.insertAdjacentHTML(
					"beforeend",
					`<option value="${y}">${y}å¹´</option>`
				);
			}

			/* ===== æœˆã®ç”Ÿæˆ ===== */
			for (let m = 1; m <= 12; m++) {
				const mm = String(m).padStart(2, "0");
				monthEl.insertAdjacentHTML(
					"beforeend",
					`<option value="${mm}">${m}æœˆ</option>`
				);
			}

			/* ---------- æ—¥ã®é¸æŠè‚¢ã‚’ä½œã‚‹ ---------- */
			function updateDays() {
				const year = yearEl.value;
				const month = monthEl.value;
				if (!year || !month) return;

				const selectedDay = dayEl.value; // â˜… ã„ã¾é¸ã°ã‚Œã¦ã„ã‚‹æ—¥

				const lastDay = new Date(year, Number(month), 0).getDate();
				dayEl.innerHTML = '<option value="">æ—¥</option>';

				for (let d = 1; d <= lastDay; d++) {
					const dd = String(d).padStart(2, "0");

					const selected = (dd === selectedDay) ? "selected" : "";

					dayEl.insertAdjacentHTML(
						"beforeend",
						`<option value="${dd}" ${selected}>${d}æ—¥</option>`
					);
				}
			}

			/* ---------- hidden ã«åæ˜  ---------- */
			function setDateHidden() {
				const y = yearEl.value;
				const m = monthEl.value;
				const d = dayEl.value;

				if (y && m && d) {
					logDateEl.value = `${y}-${m}-${d}`;
					console.log("updated logDate =", logDateEl.value);
				}
			}

			/* ---------- åˆæœŸåŒ–ï¼ˆ1å›ã ã‘ï¼‰ ---------- */
			(function initFromHidden() {
				const value = logDateEl.value;
				console.log("initial logDate =", value);

				if (!value) return;

				const [y, m, d] = value.split("-");
				yearEl.value = y;
				monthEl.value = m;
				updateDays();
				dayEl.value = d;
			})();

			/* ---------- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ ---------- */
			yearEl.addEventListener("change", () => {
				updateDays();
				setDateHidden();
			});
			monthEl.addEventListener("change", () => {
				updateDays();
				setDateHidden();
			});
			dayEl.addEventListener("change", setDateHidden);
		</script>

		<script>
			console.log("hidden logDate =", document.getElementById("logDate")?.value);
		</script>



</body>

</html>